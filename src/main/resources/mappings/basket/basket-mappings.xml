<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BasketDAO">
	<resultMap type="basket" id="basketResult">
		<id property="member_id" column="MEMBER_ID"></id>
		<result property="goods_num" column="GOODS_NUM"></result>
		<result property="basket_sum" column="BASKET_SUM"></result>
		<result property="basket_amount" column="BASKET_AMOUNT"></result>
	</resultMap>

	
	<!-- 장바구니추가 -->
	<insert id="insertBasket">
		<![CDATA[
			MERGE INTO BASKET
			USING DUAL ON (MEMBER_ID=#{member_id} AND GOODS_NUM=#{goods_num})
			WHEN MATCHED THEN
			UPDATE SET BASKET_AMOUNT = BASKET_AMOUNT + #{basket_amount}, BASKET_SUM = BASKET_SUM + #{basket_sum}
			WHEN NOT MATCHED THEN
			INSERT (MEMBER_ID, GOODS_NUM, BASKET_SUM, BASKET_AMOUNT) VALUES (#{member_id}, #{goods_num}, #{basket_sum}, #{basket_amount})
		]]>
	</insert>
	
	<select id="basketList" resultMap="basketResult">
	<![CDATA[
		SELECT * FROM BASKET
	]]>
	</select>
</mapper>
