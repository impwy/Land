<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardDAO">
    <resultMap type="board" id="boardResult">
        <id property="board_num" column="BOARD_NUM"></id>
        <result property="board_title" column="BOARD_TITLE"></result>
        <result property="board_content" column="BOARD_CONTENT"></result>
        <result property="member_id" column="MEMBER_ID"></result>
        <result property="board_viewcnt" column="BOARD_VIEWCNT"></result>
        <result property="board_commentcnt" column="BOARD_COMMENTCNT"></result>
        <result property="board_regdate" column="BOARD_REGDATE"></result>
    </resultMap>
    
    <!-- 글 등록 -->
    <insert id="insertBoard" parameterType="board">
      INSERT INTO BOARD(board_num,board_title,board_content,member_id)
    VALUES (board_num_seq.nextval,#{board_title},#{board_content},#{member_id})
    </insert>
<!--    수정-->
    <update id="updateBoard" parameterType="board">
        UPDATE BOARD SET BOARD_TITLE=#{board_title} ,BOARD_CONTENT=#{board_content} where BOARD_NUM=#{board_num}

      </update>

<!--    삭제-->
    <delete id="deleteBoard" parameterType="map"><![CDATA[
        DELETE BOARD WHERE BOARD_NUM=#{board_num}
    ]]></delete>

<!--    글 상세-->
<!--    <select id="getBoard" resultType="board"><![CDATA[-->
<!--        SELECT  * FROM BOARD WHERE BOARD_NUM=#{board_num}-->

<!--    ]]></select>-->
<!--    글 읽기 궁성-->
    <sql id="selectFromBoard">
        SELECT board_num, board_title, board_content, member_id, board_viewcnt, board_commentcnt, board_regdate
        FROM board
    </sql>
    <select id="getBoard" resultType="board">
        <include refid="selectFromBoard"/>
        where board_num=#{board_num}
    </select>
<!--    글 목록-->
    <select id="getBoardList" resultMap="boardResult">
        SELECT * FROM BOARD
        where 1=1
        ORDER BY BOARD_NUM DESC
    </select>

    <select id="getBoardPage" parameterType="map" resultType="board">
        SELECT * FROM(
                    SELECT ROWNUM AS RN, A.*  FROM
                (SELECT *  FROM board ORDER BY board_regdate DESC,board_num desc) A )
        WHERE RN BETWEEN ${start} AND ${end}
    </select>

<!--    카운트-->
    <select id="count" resultType="int">
        select count(*) from board
    </select>

<!--    조회수 증가-->
    <update id="increaseViewCnt">
        update board
            set board_viewcnt=board_viewcnt +1
            where board_num=#{board_num}
    </update>

</mapper>
